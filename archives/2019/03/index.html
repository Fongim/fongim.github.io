<!DOCTYPE html>
<html>
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  
  <title>Archives: 2019/3 | 派大星星星星</title>
  
  <meta name="keywords" content="iOS">
  
  

  

  <meta name="HandheldFriendly" content="True">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <!-- meta -->
  

  <!-- link -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.css">
  
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/node-waves@0.7.6/dist/waves.min.css">
  
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.6.3/css/all.min.css">
  

  
  <link rel="shortcut icon" type="image/x-icon" href="https://raw.githubusercontent.com/Fongim/personal_blog_image/master/image/fat_cat_header_small.png">
  

  
    <link rel="stylesheet" href="/style.css">
  

  <script>
    function setLoadingBarProgress(num) {
      document.getElementById('loading-bar').style.width=num+"%";
    }
  </script>

  
  
    <!-- ba -->
    <script>
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?420331e790ec3f2c56b1660b4958f8c3";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
    </script>
  
</head>

<body>
  
  
  <div class="cover-wrapper">
    <cover class="cover  half">
      
        
  <img class="logo" src="https://raw.githubusercontent.com/Fongim/personal_blog_image/master/image/fat_cat_header_small.png">


  <div class="m_search">
    <form name="searchform" class="form u-search-form">
      <input type="text" class="input u-search-input" placeholder>
      <i class="icon fas fa-search fa-fw"></i>
    </form>
  </div>

<div class="menu navgation">
  <ul class="h-list">
    
      
        <li>
          <a class="nav home" href="/" id="home">
            <i class="fas fa-beer fa-fw"></i>&nbsp;博客
          </a>
        </li>
      
        <li>
          <a class="nav home" href="/categories/" id="categories">
            <i class="fas fa-folder-open fa-fw"></i>&nbsp;分类
          </a>
        </li>
      
        <li>
          <a class="nav home" href="/tags/" id="tags">
            <i class="fas fa-tags fa-fw"></i>&nbsp;标签
          </a>
        </li>
      
        <li>
          <a class="nav home" href="/archives/" id="archives">
            <i class="fas fa-archive fa-fw"></i>&nbsp;归档
          </a>
        </li>
      
    
  </ul>
</div>

      
    </cover>
    <header class="l_header pure">
  <div id="loading-bar-wrapper">
    <div id="loading-bar" class="pure"></div>
  </div>

	<div class="wrapper">
		<div class="nav-main container container--flex">
      <a class="logo flat-box" href="/">
        
          派大星星星星
        
      </a>
			<div class="menu navgation">
				<ul class="h-list">
          
  					
  						<li>
								<a class="nav flat-box" href="/" id="home">
									<i class="fas fa-beer fa-fw"></i>&nbsp;博客
								</a>
							</li>
      			
  						<li>
								<a class="nav flat-box" href="/categories/" id="categories">
									<i class="fas fa-folder-open fa-fw"></i>&nbsp;分类
								</a>
							</li>
      			
  						<li>
								<a class="nav flat-box" href="/tags/" id="tags">
									<i class="fas fa-tags fa-fw"></i>&nbsp;标签
								</a>
							</li>
      			
  						<li>
								<a class="nav flat-box" href="/archives/" id="archives">
									<i class="fas fa-archive fa-fw"></i>&nbsp;归档
								</a>
							</li>
      			
      		
				</ul>
			</div>

			
				<div class="m_search">
					<form name="searchform" class="form u-search-form">
						<input type="text" class="input u-search-input" placeholder="搜索">
						<i class="icon fas fa-search fa-fw"></i>
					</form>
				</div>
			
			<ul class="switcher h-list">
				
					<li class="s-search"><a class="fas fa-search fa-fw" href="javascript:void(0)"></a></li>
				
				<li class="s-menu"><a class="fas fa-bars fa-fw" href="javascript:void(0)"></a></li>
			</ul>
		</div>

		<div class="nav-sub container container--flex">
			<a class="logo flat-box"></a>
			<ul class="switcher h-list">
				<li class="s-comment"><a class="flat-btn fas fa-comments fa-fw" href="javascript:void(0)"></a></li>
        
          <li class="s-toc"><a class="flat-btn fas fa-list fa-fw" href="javascript:void(0)"></a></li>
        
			</ul>
		</div>
	</div>
</header>
	<aside class="menu-phone">
    <header>
		<nav class="menu navgation">
      <ul>
        
          
            <li>
							<a class="nav flat-box" href="/" id="home">
								<i class="fas fa-beer fa-fw"></i>&nbsp;博客
							</a>
            </li>
          
            <li>
							<a class="nav flat-box" href="/categories/" id="categories">
								<i class="fas fa-folder-open fa-fw"></i>&nbsp;分类
							</a>
            </li>
          
            <li>
							<a class="nav flat-box" href="/tags/" id="tags">
								<i class="fas fa-tags fa-fw"></i>&nbsp;标签
							</a>
            </li>
          
            <li>
							<a class="nav flat-box" href="/archives/" id="archives">
								<i class="fas fa-archive fa-fw"></i>&nbsp;归档
							</a>
            </li>
          
       
      </ul>
		</nav>
    </header>
	</aside>
<script>setLoadingBarProgress(40);</script>

  </div>


  <div class="l_body">
    <div class='body-wrapper'>
      <div class="l_main">
	
		
  <section class="post-list">
    
      
        
          
        
          
        
          
        
          
        
          
        
      
    
    
      
        
          <div class="post-wrapper">
            <article class="post reveal ">
  


  <section class="meta">
    
    
    <div class="meta" id="header-meta">
      
        
  <h2 class="title">
    <a href="/2019-03-22-ios-alipay-h5-solution/">
      iOS集成支付宝H5支付实现跳转与回调的解决方案
    </a>
  </h2>


      
      <div class="new-meta-box">
        
          
        
          
            
  <div class="new-meta-item author">
    <a href="https://paaatrick.com" rel="nofollow">
      
        <i class="fas fa-user" aria-hidden="true"></i>
      
      <p>大星</p>
    </a>
  </div>


          
        
          
            <div class="new-meta-item date">
  <a class="notlink">
    <i class="fas fa-calendar-alt" aria-hidden="true"></i>
    <p>2019-03-22</p>
  </a>
</div>

          
        
          
            
  
  <div class="new-meta-item category">
    <a href="/categories/Tech/" rel="nofollow">
      <i class="fas fa-folder-open" aria-hidden="true"></i>
      <p>Tech</p>
    </a>
  </div>


          
        
          
            

          
        
          
            

          
        
      </div>
      
        <hr>
      
    </div>
  </section>


  <section class="article typo">
    <div class="article-entry" itemprop="articleBody">
      <h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>最近有个需求，不能在iOS客户端内集成支付宝和微信的App支付SDK（为了防苹果审核检测SDK），因此使用H5支付，虽然微信和支付宝的H5支付文档都说不要在App内使用H5支付而是使用App支付，但办法总是有的。</p>
<p>这篇讲的是支付宝H5支付如何从App跳转支付宝以及如何从支付宝跳转回App，微信支付的见这篇：</p>
<blockquote>
<p> <a href="https://paaatrick.com/2019-03-22-ios-wxpay-h5-solution/">iOS集成H5微信支付实现跳转与回调的解决方案</a></p>
</blockquote>
<p>实现的效果是：App→支付宝→支付(成功失败或取消)→App</p>
      
        <div class="readmore">
          <a href="/2019-03-22-ios-alipay-h5-solution/" class="flat-box">
            <i class="fas fa-book-open fa-fw" aria-hidden="true"></i>
            阅读全文
          </a>
        </div>
      
    </div>
    
      <div class="full-width auto-padding tags">
        
          <a href="/tags/iOS/" rel="nofollow"><i class="fas fa-hashtag fa-fw"></i>iOS</a>
        
          <a href="/tags/Objective-C/" rel="nofollow"><i class="fas fa-hashtag fa-fw"></i>Objective-C</a>
        
      </div>
    
  </section>
</article>

          </div>
        
      
        
          <div class="post-wrapper">
            <article class="post reveal ">
  


  <section class="meta">
    
    
    <div class="meta" id="header-meta">
      
        
  <h2 class="title">
    <a href="/2019-03-22-ios-wxpay-h5-solution/">
      iOS集成H5微信支付实现跳转与回调的解决方案
    </a>
  </h2>


      
      <div class="new-meta-box">
        
          
        
          
            
  <div class="new-meta-item author">
    <a href="https://paaatrick.com" rel="nofollow">
      
        <i class="fas fa-user" aria-hidden="true"></i>
      
      <p>大星</p>
    </a>
  </div>


          
        
          
            <div class="new-meta-item date">
  <a class="notlink">
    <i class="fas fa-calendar-alt" aria-hidden="true"></i>
    <p>2019-03-22</p>
  </a>
</div>

          
        
          
            
  
  <div class="new-meta-item category">
    <a href="/categories/Tech/" rel="nofollow">
      <i class="fas fa-folder-open" aria-hidden="true"></i>
      <p>Tech</p>
    </a>
  </div>


          
        
          
            

          
        
          
            

          
        
      </div>
      
        <hr>
      
    </div>
  </section>


  <section class="article typo">
    <div class="article-entry" itemprop="articleBody">
      <h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>最近有个需求，不能在iOS客户端内集成支付宝和微信的App支付SDK（为了防苹果审核检测SDK），因此使用H5支付，虽然微信和支付宝的H5支付文档都说不要在App内使用H5支付而是使用App支付，但办法总是有的。</p>
<p>这篇讲的是H5微信支付如何从App跳转微信以及如何从微信跳转回App，支付宝的见这篇：</p>
<blockquote>
<p> <a href="https://paaatrick.com/2019-03-22-ios-alipay-h5-solution/">iOS集成支付宝H5支付实现跳转与回调的解决方案</a></p>
</blockquote>
<p>实现的效果是：App→微信→支付(成功失败或取消)→App</p>
      
        <div class="readmore">
          <a href="/2019-03-22-ios-wxpay-h5-solution/" class="flat-box">
            <i class="fas fa-book-open fa-fw" aria-hidden="true"></i>
            阅读全文
          </a>
        </div>
      
    </div>
    
      <div class="full-width auto-padding tags">
        
          <a href="/tags/iOS/" rel="nofollow"><i class="fas fa-hashtag fa-fw"></i>iOS</a>
        
          <a href="/tags/Objective-C/" rel="nofollow"><i class="fas fa-hashtag fa-fw"></i>Objective-C</a>
        
      </div>
    
  </section>
</article>

          </div>
        
      
        
          <div class="post-wrapper">
            <article class="post reveal ">
  


  <section class="meta">
    
    
    <div class="meta" id="header-meta">
      
        
  <h2 class="title">
    <a href="/2019-03-12-if-nsarray-null/">
      判断一个 NSArray 是否为空
    </a>
  </h2>


      
      <div class="new-meta-box">
        
          
        
          
            
  <div class="new-meta-item author">
    <a href="https://paaatrick.com" rel="nofollow">
      
        <i class="fas fa-user" aria-hidden="true"></i>
      
      <p>大星</p>
    </a>
  </div>


          
        
          
            <div class="new-meta-item date">
  <a class="notlink">
    <i class="fas fa-calendar-alt" aria-hidden="true"></i>
    <p>2019-03-12</p>
  </a>
</div>

          
        
          
            
  
  <div class="new-meta-item category">
    <a href="/categories/Note/" rel="nofollow">
      <i class="fas fa-folder-open" aria-hidden="true"></i>
      <p>Note</p>
    </a>
  </div>


          
        
          
            

          
        
          
            

          
        
      </div>
      
        <hr>
      
    </div>
  </section>


  <section class="article typo">
    <div class="article-entry" itemprop="articleBody">
      <figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> ([array isKindOfClass:[<span class="built_in">NSArray</span> <span class="keyword">class</span>]] &amp;&amp; array.count &gt; <span class="number">0</span>)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"这是一个非空数组"</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<hr>

      
    </div>
    
      <div class="full-width auto-padding tags">
        
          <a href="/tags/iOS/" rel="nofollow"><i class="fas fa-hashtag fa-fw"></i>iOS</a>
        
          <a href="/tags/Objective-C/" rel="nofollow"><i class="fas fa-hashtag fa-fw"></i>Objective-C</a>
        
      </div>
    
  </section>
</article>

          </div>
        
      
        
          <div class="post-wrapper">
            <article class="post reveal ">
  


  <section class="meta">
    
    
    <div class="meta" id="header-meta">
      
        
  <h2 class="title">
    <a href="/2019-03-05-iphone-pixel-point-size-scale/">
      iPhone屏幕各种尺寸分辨率（更新至XS）
    </a>
  </h2>


      
      <div class="new-meta-box">
        
          
        
          
            
  <div class="new-meta-item author">
    <a href="https://paaatrick.com" rel="nofollow">
      
        <i class="fas fa-user" aria-hidden="true"></i>
      
      <p>大星</p>
    </a>
  </div>


          
        
          
            <div class="new-meta-item date">
  <a class="notlink">
    <i class="fas fa-calendar-alt" aria-hidden="true"></i>
    <p>2019-03-05</p>
  </a>
</div>

          
        
          
            
  
  <div class="new-meta-item category">
    <a href="/categories/Note/" rel="nofollow">
      <i class="fas fa-folder-open" aria-hidden="true"></i>
      <p>Note</p>
    </a>
  </div>


          
        
          
            

          
        
          
            

          
        
      </div>
      
        <hr>
      
    </div>
  </section>


  <section class="article typo">
    <div class="article-entry" itemprop="articleBody">
      <table>
<thead>
<tr>
<th>Device</th>
<th>Logic Point</th>
<th>Logic Pixel</th>
<th>Size</th>
<th>Scale</th>
</tr>
</thead>
<tbody><tr>
<td>iPhone 2G</td>
<td>480 × 320</td>
<td>480 × 320</td>
<td>3.5</td>
<td>1x</td>
</tr>
<tr>
<td>iPhone 3</td>
<td>480 × 320</td>
<td>480 × 320</td>
<td>3.5</td>
<td>1x</td>
</tr>
<tr>
<td>iPhone 3GS</td>
<td>480 × 320</td>
<td>480 × 320</td>
<td>3.5</td>
<td>1x</td>
</tr>
<tr>
<td>iPhone 4</td>
<td>480 × 320</td>
<td>960 × 640</td>
<td>3.5</td>
<td>2x</td>
</tr>
<tr>
<td>iPhone 4S</td>
<td>480 × 320</td>
<td>960 × 640</td>
<td>3.5</td>
<td>2x</td>
</tr>
<tr>
<td>iPhone 5</td>
<td>568 × 320</td>
<td>1136 × 640</td>
<td>4.0</td>
<td>2x</td>
</tr>
<tr>
<td>iPhone 5S</td>
<td>568 × 320</td>
<td>1136 × 640</td>
<td>4.0</td>
<td>2x</td>
</tr>
<tr>
<td>iPhone 5C</td>
<td>568 × 320</td>
<td>1136 × 640</td>
<td>4.0</td>
<td>2x</td>
</tr>
<tr>
<td>iPhone 6</td>
<td>667 × 375</td>
<td>1334 × 750</td>
<td>4.7</td>
<td>2x</td>
</tr>
<tr>
<td>iPhone 6 Plus</td>
<td>736 × 414</td>
<td>2208 × 1242</td>
<td>5.5</td>
<td>3x</td>
</tr>
<tr>
<td>iPhone 6S</td>
<td>667 × 375</td>
<td>1334 × 750</td>
<td>4.7</td>
<td>2x</td>
</tr>
<tr>
<td>iPhone 6S Plus</td>
<td>736 × 414</td>
<td>2208 × 1242</td>
<td>5.5</td>
<td>3x</td>
</tr>
<tr>
<td>iPhone SE</td>
<td>568 × 320</td>
<td>1136 × 640</td>
<td>4.0</td>
<td>2x</td>
</tr>
<tr>
<td>iPhone 7</td>
<td>667 × 375</td>
<td>1334 × 750</td>
<td>4.7</td>
<td>2x</td>
</tr>
<tr>
<td>iPhone 7 Plus</td>
<td>736 × 414</td>
<td>2208 × 1242</td>
<td>5.5</td>
<td>3x</td>
</tr>
<tr>
<td>iPhone 8</td>
<td>667 × 375</td>
<td>1334 × 750</td>
<td>4.7</td>
<td>2x</td>
</tr>
<tr>
<td>iPhone 8 Plus</td>
<td>736 × 414</td>
<td>2208 × 1242</td>
<td>5.5</td>
<td>3x</td>
</tr>
<tr>
<td>iPhone X</td>
<td>812 × 375</td>
<td>2436 × 1125</td>
<td>5.8</td>
<td>3x</td>
</tr>
<tr>
<td>iPhone XS</td>
<td>812 × 375</td>
<td>2436 × 1125</td>
<td>5.8</td>
<td>3x</td>
</tr>
<tr>
<td>iPhone XR</td>
<td>896 × 414</td>
<td>1792 × 828</td>
<td>6.1</td>
<td>2x</td>
</tr>
<tr>
<td>iPhone XS Max</td>
<td>896 × 414</td>
<td>2688 × 1242</td>
<td>6.5</td>
<td>3x</td>
</tr>
</tbody></table>
<hr>

      
    </div>
    
      <div class="full-width auto-padding tags">
        
          <a href="/tags/iOS/" rel="nofollow"><i class="fas fa-hashtag fa-fw"></i>iOS</a>
        
          <a href="/tags/Objective-C/" rel="nofollow"><i class="fas fa-hashtag fa-fw"></i>Objective-C</a>
        
      </div>
    
  </section>
</article>

          </div>
        
      
        
          <div class="post-wrapper">
            <article class="post reveal ">
  


  <section class="meta">
    
    
    <div class="meta" id="header-meta">
      
        
  <h2 class="title">
    <a href="/2019-03-01-ios-interview-thing/">
      一些iOS面试基础题总结
    </a>
  </h2>


      
      <div class="new-meta-box">
        
          
        
          
            
  <div class="new-meta-item author">
    <a href="https://paaatrick.com" rel="nofollow">
      
        <i class="fas fa-user" aria-hidden="true"></i>
      
      <p>大星</p>
    </a>
  </div>


          
        
          
            <div class="new-meta-item date">
  <a class="notlink">
    <i class="fas fa-calendar-alt" aria-hidden="true"></i>
    <p>2019-03-01</p>
  </a>
</div>

          
        
          
            
  
  <div class="new-meta-item category">
    <a href="/categories/Note/" rel="nofollow">
      <i class="fas fa-folder-open" aria-hidden="true"></i>
      <p>Note</p>
    </a>
  </div>


          
        
          
            

          
        
          
            

          
        
      </div>
      
        <hr>
      
    </div>
  </section>


  <section class="article typo">
    <div class="article-entry" itemprop="articleBody">
      <a id="more"></a>

<h2 id="多线程"><a href="#多线程" class="headerlink" title="多线程"></a>多线程</h2><h4 id="线程之间同步"><a href="#线程之间同步" class="headerlink" title="线程之间同步"></a>线程之间同步</h4><ol>
<li>原子操作 Atomic</li>
<li>加锁（互斥锁、递归锁、读写锁）NSLock，OSSpinLock</li>
</ol>
<h4 id="多线程之间通信"><a href="#多线程之间通信" class="headerlink" title="多线程之间通信"></a>多线程之间通信</h4><p>performSelectorOnMainThread:withObject:waitUntilDone:</p>
<h4 id="如何保证线程安全"><a href="#如何保证线程安全" class="headerlink" title="如何保证线程安全"></a>如何保证线程安全</h4><ol>
<li>OSSpinLock 自旋锁</li>
<li>dispatch_semaphore</li>
<li>NSLock 等各种锁</li>
<li>@synchronized</li>
</ol>
<h4 id="多线程的坑"><a href="#多线程的坑" class="headerlink" title="多线程的坑"></a>多线程的坑</h4><ol>
<li>常驻线程</li>
</ol>
<p>常驻线程多了影响CPU效率</p>
<p>AFNetworking2.0因为用的NSURLConnection有缺陷，需要所在线程一直存活，所以保持了个常驻线程，3.0用了NSURLSession，可以指定回调的delegateQueue于是弃用常驻线程。</p>
<p>[runloop run]是常驻线程，[runloop runUntilDate]指定保活时长</p>
<ol start="2">
<li>并发</li>
</ol>
<p>GCD本着最大化CPU效率的原则会多创建线程，但如果是IO类操作，需要等待数据的空档会继续创建新线程导致内存失控。类似数据库操作尽量用串行队列避免多线程并发导致问题。因为创建线程需要堆栈内存，切换线程也消耗CPU。</p>
<ol start="3">
<li>死锁</li>
</ol>
<p>串行队列（如主队列）同步操作</p>
<h2 id="AutoLayout"><a href="#AutoLayout" class="headerlink" title="AutoLayout"></a>AutoLayout</h2><p>更新屏幕时，Layout Engine从上到下调用layoutSubviews()通过 Cassowary 算法计算各个子视图的位置，算出来后将子视图的 frame 从 Layout Engine 里拷贝出来，接下来的过程就跟手写frame是一样的了。iOS12优化了性能，以前元素多了会导致性能下降，现正不会了</p>
<h2 id="objc-msgSend"><a href="#objc-msgSend" class="headerlink" title="objc_msgSend"></a>objc_msgSend</h2><ol>
<li>检查这个selector是不是要忽略的</li>
<li>检查target是不是nil</li>
</ol>
<ul>
<li>如果有相应处理nil的函数就跳转到该函数</li>
<li>如果没有就自动清理现场并返回，这就是OC中给nil发消息不会崩溃的原因</li>
</ul>
<ol start="3">
<li>确定不是给nil发消息后，在该class的缓存中查找方法对应的IMP实现</li>
</ol>
<ul>
<li>如果找到就跳转进去</li>
<li>如果没找到就在方法分发表里继续查找，直到找到NSObject为止</li>
</ul>
<ol start="4">
<li>如果还没找到就开始消息转发，上述过程就是通过SEL快速查找IMP的过程</li>
</ol>
<h2 id="Runtime"><a href="#Runtime" class="headerlink" title="Runtime"></a>Runtime</h2><p>C语言中，编译期函数的调用就决定调用哪个函数，而OC只有在真正运行时才根据函数名称找到对应函数来调用。需要一个运行时系统来动态地创建类和对象、消息传递和转发</p>
<ol>
<li>讲一下 OC 的消息机制</li>
</ol>
<ul>
<li>OC中的方法调用其实都是转成了objc_msgSend函数的调用，给receiver（方法调用者）发送了一条消息（selector方法名）</li>
<li>objc_msgSend底层有3大阶段:消息发送（当前类、父类中查找）、动态方法解析、消息转发</li>
<li>当递归地找不到selector时，启动消息转发：resolveInstanceMethod、resolveClassMethod、forwardingTargetForSelector</li>
</ul>
<ol start="2">
<li>什么是Runtime？平时项目中有用过么？</li>
</ol>
<ul>
<li>OC是一门动态性比较强的编程语言，允许很多操作推迟到程序运行时再进行</li>
<li>OC的动态性就是由Runtime来支撑和实现的，Runtime是一套C语言的API，封装了很多动态性相关的函数</li>
<li>平时编写的OC代码，底层都是转换成了Runtime API进行调用</li>
</ul>
<ol start="5">
<li>Runtime 的应用（优点）：</li>
</ol>
<ul>
<li>实现多继承 Multiple Inheritance</li>
<li>Method Swizzling -&gt; 无侵入埋点 -&gt; 使用Category进行</li>
<li>Aspect Oriented Prigramming 面向切面编程AOP -&gt; 如日志、身份验证、缓存等模块</li>
<li>isa Swizzling -&gt; KVO的实现</li>
<li>Associated Object关联对象(给Category添加属性) objc_set(get)AssociatedObject </li>
<li>动态地增加方法</li>
<li>NSCoding 的自动归档和自动解档</li>
<li>字典和模型相互转换！</li>
<li>异常保护（保护数组越界问题）</li>
</ul>
<ol start="6">
<li>Runtime 的缺点</li>
</ol>
<ul>
<li>Method Swizzling 不是原子操作，放在+load里没问题，放在+initialize里就有问题了</li>
<li>重写方法而不调用super方法可能有问题</li>
</ul>
<ol start="7">
<li>Runtime 注意事项</li>
</ol>
<ul>
<li>Swizzling应该总在+load中执行</li>
<li>Swizzling应该总在dispatch_once中执行 -&gt; 因为会改变全局状态所以应该只执行一次</li>
<li>+load中执行Swizzling时，不要调用[super load] -&gt; 避免偶数次执行Swizzling</li>
</ul>
<p>SEL其本身是一个Int类型的地址，地址中存放着方法的名字。</p>
<h2 id="Category"><a href="#Category" class="headerlink" title="Category"></a>Category</h2><p>通过Runtime给类添加方法，可以把类的实现分开在几个不同的文件，减少单个文件体积、不同功能组织到不同的Category里、可以由多人开发一个类、可以按需加载想要的category、可以把framework的私有方法公开</p>
<p>与extension不同的是，extension需要有类的源码才能添加，所以无法为系统类添加extension。</p>
<p>而category是运行时添加的。所以，extension可以添加实例变量，而category只能添加实例方法、类方法、协议、属性，但是不能添加实例变量。</p>
<p>category并不是完全替换掉原来类的方法，而是附加到方法列表的前面，而runtime寻找方法是顺着找的，找到category覆盖的方法后就执行了</p>
<h2 id="NSObject与objc-class"><a href="#NSObject与objc-class" class="headerlink" title="NSObject与objc_class"></a>NSObject与objc_class</h2><p>NSObject 继承自 objc_class<br>objc_class 继承自 objc_object</p>
<p>objc_object -&gt; objc_class -&gt; NSObject</p>
<p>所以OC中，类也是一个对象。</p>
<p>objc_class中，除了isa，还有3个成员变量，一个是父类的指针，一个是方法缓存，最后一个这个类的实例方法链表。</p>
<p>每个类都有单独的元类，所以类的superclass指针递归最后指向NSObject，NSObject没有超类所以指向nil。类的isa指向对应唯一的元类，每个元类的isa都指向rootMetaClass，rootMetaClass的superClass指向NSObject，isa指向自己</p>
<p>元类中保存了创建类对象以及类方法所需的所有信息</p>
<h2 id="Runloop"><a href="#Runloop" class="headerlink" title="Runloop"></a>Runloop</h2><h4 id="介绍"><a href="#介绍" class="headerlink" title="介绍"></a>介绍</h4><p>运行循环，在程序运行过程中循环做一些事情，如果没有Runloop程序执行完毕就会立即退出，如果有Runloop程序会一直运行，并且时时刻刻在等待用户的输入操作。RunLoop可以在需要的时候自己跑起来运行，在没有操作的时候就停下来休息。充分节省CPU资源，提高程序性能。</p>
<h2 id="Source"><a href="#Source" class="headerlink" title="Source"></a>Source</h2><p>分为Input Source输入源和定时源Timer Source</p>
<h4 id="五个Mode"><a href="#五个Mode" class="headerlink" title="五个Mode"></a>五个Mode</h4><ol>
<li>默认（主线程的）Mode：NSDefaultRunLoopMode</li>
<li>界面追踪Mode：UITrackingRunLoopMode</li>
<li>首次启动的第一个Mode：UIInitializationRunLoopMode</li>
</ol>
<h4 id="作用"><a href="#作用" class="headerlink" title="作用"></a>作用</h4><ol>
<li>保持程序持续运行，程序一启动就会开一个主线程，主线程一开起来就会跑一个主线程对应的RunLoop,RunLoop保证主线程不会被销毁，也就保证了程序的持续运行，对于子线程可以使用run来常驻线程。</li>
<li>保证NSTimer正常运转</li>
<li>线上监测App卡顿情况</li>
<li>处理App中的各种事件（比如：触摸事件，定时器事件，Selector事件等）</li>
<li>节省CPU资源，提高程序性能，程序运行起来时，当什么操作都没有做的时候，RunLoop就告诉CUP，现在没有事情做，我要去休息，这时CUP就会将其资源释放出来去做其他的事情，当有事情做的时候RunLoop就会立马起来去做事情</li>
</ol>
<h4 id="过程"><a href="#过程" class="headerlink" title="过程"></a>过程</h4><ol>
<li>进入loop</li>
<li>do while 保活线程：触发Timer回调、触发Source()回调、执行block</li>
<li>进入休眠</li>
<li>等待mach_port消息（如Timer时间到、Runloop超时、被调用者唤醒）</li>
<li>唤醒，处理消息</li>
<li>判断是否进入下一个loop</li>
</ol>
<h4 id="监测卡顿的方法"><a href="#监测卡顿的方法" class="headerlink" title="监测卡顿的方法"></a>监测卡顿的方法</h4><ol>
<li>创建观察者</li>
<li>把观察者添加到主线程的Runloop的common模式下观察，然后创建一个常驻子线程专门用来监控主线程的Runloop状态</li>
<li>一旦发现runloop进入睡眠前的状态或者唤醒后的状态在设置的时间阈值内没有变化，即可判定为卡顿，用第三方库PLCrashReporter来获取堆栈信息，上报服务器。后续分析。</li>
</ol>
<h2 id="autoreleasepool"><a href="#autoreleasepool" class="headerlink" title="autoreleasepool"></a>autoreleasepool</h2><p>配合runloop的，每次runloop开启时重建自动释放池，休息前释放掉池里的东西如Timer<br>ARC下自动创建的在子线程结束后释放，手动创建的在作用域大括号结束后释放<br>底层实现 AutoReleasePoolPage 是一个双向链表，有push release pop操作</p>
<h2 id="iOS系统架构"><a href="#iOS系统架构" class="headerlink" title="iOS系统架构"></a>iOS系统架构</h2><p>四个层</p>
<ul>
<li>第一层：用户体验层：SpringBoard</li>
<li>第二层：应用框架层：CocoaTouch</li>
<li>第三层：核心框架层：Metal、图形媒体核心框架</li>
<li>第四层：Darwin层：XNU、内核、驱动</li>
</ul>
<p>iOS的可执行文件和动态库都是Mach-O格式，加载App实际就是加载Mach-O文件。</p>
<h2 id="App启动过程与优化"><a href="#App启动过程与优化" class="headerlink" title="App启动过程与优化"></a>App启动过程与优化</h2><ol>
<li>main()执行前</li>
</ol>
<ul>
<li>加载可执行文件（App的.o文件的集合）</li>
<li>加载动态链接库，进行rebase指针调整和bind符号绑定</li>
<li>Objc Runtime 的初始处理，包括 Objc 相关类的注册、Category注册、selector 唯一性检查</li>
<li>+load()初始化<blockquote>
<p>这个阶段的优化有 1. 减少动态库加载（合并动态库）2. 减少加载启动后不会去用的类和方法 3. 少用+load，或用 +initialize替换，因为runtime 的 Method Swizzling 操作每次4ms</p>
</blockquote>
</li>
</ul>
<ol start="2">
<li>main()执行后</li>
</ol>
<ul>
<li>指 main() 执行开始到 didFinishLaunchingWithOptions 方法里首屏渲染相关方法完成</li>
<li>配置初始化文件的IO操作</li>
<li>首屏列表大数据的读取</li>
<li>首屏渲染的大量计算<blockquote>
<p>优化方法有把各种与首屏渲染不相干的初始化挪走或子线程处理</p>
</blockquote>
</li>
</ul>
<ol start="3">
<li>首屏渲染完成后</li>
</ol>
<ul>
<li>指 didFinishLaunchingWithOptions 作用域内执行首屏渲染之后的所有方法执行完成</li>
<li>非首屏其他业务服务模块的初始化</li>
<li>监听的注册</li>
<li>配置文件的读写<blockquote>
<p>把可能卡住主线程的方法挪走或子线程处理</p>
</blockquote>
</li>
</ul>
<h2 id="UIScrollView-的代理方法"><a href="#UIScrollView-的代理方法" class="headerlink" title="UIScrollView 的代理方法"></a>UIScrollView 的代理方法</h2><ol>
<li>滚动完 scrollViewDidScroll </li>
<li>缩放完 scrollViewDidZoom</li>
<li>将要开始拖动 scrollViewWillBeginDragging</li>
<li>将要结束拖动 scrollViewWillEndDragging</li>
<li>滑动将要减速、 滑动减速完成</li>
<li>滚动动画完成</li>
<li>将要开始缩放、已经结束缩放</li>
</ol>
<h2 id="响应连和事件传递"><a href="#响应连和事件传递" class="headerlink" title="响应连和事件传递"></a>响应连和事件传递</h2><ol>
<li><p>hitTest方法检测看是否返回</p>
</li>
<li><p>继承<code>UIResponder</code>的类才能响应，如<code>UIApplication</code>、<code>UIView</code>、<code>UIViewController</code>。而<code>CALayer</code>是继承自<code>NSObject</code>的，不能响应</p>
</li>
<li><p>事件首先传递给<code>UIApplication</code>，然后向下分发给<code>UIWindow</code>，然后分发给最下层的<code>UIView</code>，逐步调用<code>hitTest</code>从屏内向外找，当某个<code>UIView</code>返回YES时就递归对其<code>SubView</code>执行<code>hitTest</code>，直到找到最后一个</p>
</li>
</ol>
<ul>
<li>某<code>UIView</code>不接受事件的情况：</li>
</ul>
<ol>
<li>alpha &lt; 0.01</li>
<li>userInteractionEnabled = NO</li>
<li>hidden = YES</li>
</ol>
<h2 id="UIView-和-CALayer-的区别和联系"><a href="#UIView-和-CALayer-的区别和联系" class="headerlink" title="UIView 和 CALayer 的区别和联系"></a>UIView 和 CALayer 的区别和联系</h2><ol>
<li>UIView能响应，CALayer不能</li>
<li>View的frame(和bounds)是简单返回layer的frame(bound), 而layer的frame由几个参数决定</li>
<li>UIView 是 CALayer 的代理</li>
<li>每个UIView内都有一个CALayer（即有个属性）</li>
</ol>
<h2 id="轮播图朴素实现的集中方法"><a href="#轮播图朴素实现的集中方法" class="headerlink" title="轮播图朴素实现的集中方法"></a>轮播图朴素实现的集中方法</h2><ol>
<li>UICollectionView, 简单粗暴放100个Cell</li>
<li>UIScrollView 首尾各放一个展示</li>
<li>UIScrollView 三个ImageView实现</li>
<li>UIImageView 自己实现layer转场动画</li>
</ol>
<h2 id="TableView-和-CollectionView-必选的代理方法"><a href="#TableView-和-CollectionView-必选的代理方法" class="headerlink" title="TableView 和 CollectionView 必选的代理方法"></a>TableView 和 CollectionView 必选的代理方法</h2><ul>
<li>delegate都是可选</li>
<li>datasource各有两个必选</li>
<li>table: cellForRowAtIndexPath、numberOfRowsInSection</li>
<li>collection: cellForItemAtIndexPath、numberOfItemsInSection</li>
</ul>
<h2 id="UITableView-的优化思路"><a href="#UITableView-的优化思路" class="headerlink" title="UITableView 的优化思路"></a>UITableView 的优化思路</h2><h4 id="流程："><a href="#流程：" class="headerlink" title="流程："></a>流程：</h4><ol>
<li>获取数据；</li>
<li>把数据转化成model、存进数组；</li>
<li>tableview调用reloadData刷新数据；</li>
<li>在代理方法cellForRowAtIndexPath里，创建自定义的cell，把model赋值给cell；</li>
<li>cell在对应的model的set方法里，根据拿到的model，设置图片的image，设置label的text等(控件都以懒加载形式初始化)；</li>
<li>在代理方法heightForRowAtIndexPath里，根据model，算出当前行应该显示多少的高度；</li>
<li>在cell的layoutSubviews方法里，布局子控件。</li>
</ol>
<h4 id="优化思路"><a href="#优化思路" class="headerlink" title="优化思路"></a>优化思路</h4><ol>
<li><p>避免主线程阻塞<br>1/2步里的获取数据、数据处理等耗时操作，应该放入后台线程异步处理，处理好后再通知主线程刷新界面。</p>
</li>
<li><p>避免频繁的对象创建<br>对象的创建会发送内存分配、属性调整等。<br>所以，首先，尽量用轻量的对象代替重量的对象。比如CALayer代替UIView。<br>接着，多利用缓存思想，对象创建后缓存起来，需要的时候再拿出来用。合理利用内存开销，减少CPU开销。<br>把 Cell setModel里的一些操作放在第二步数据转model里</p>
</li>
<li><p>减少对象的属性赋值操作<br>尤其是UIView的frame/bounds等属性的赋值操作，会产生比较大的CPU消耗。<br>尽量少让Cell里空间动态变化，有规律的话筛分成多个固定cell</p>
</li>
<li><p>异步绘制<br>文本渲染、图像绘制都是比较消耗性能的操作，而UILabel等控件都是在主线程进行的文本绘制。这会对性能产生比较大的影响。<br>UIKit和CoreAnimation相关操作必须在主线程中进行，其它的可以在后台线程异步执行</p>
</li>
</ol>
<ol start="5">
<li>简化视图结构</li>
</ol>
<ul>
<li>GPU在绘制图像前，会把重叠的视图进行混合，视图结构越复杂，这个操作就越耗时，如果存在透明视图，混合过程会更加复杂。</li>
<li>所以，我们可以：</li>
<li>尽量避免复杂的图层结构</li>
<li>少使用透明的视图</li>
<li>不透明的视图，设置opaque = YES </li>
</ul>
<ol start="6">
<li>减少离屏渲染</li>
</ol>
<ul>
<li><p>老生常谈之圆角问题</p>
</li>
<li><p>圆角是开发中经常使用到的美化方式，但一般的设置cornerRadius时会配合masksToBounds属性，这就会造成离屏渲染。</p>
</li>
<li><p>关于这种问题的处理，大致有两个思路</p>
</li>
<li><p>异步绘制一张圆角的图片来显示；</p>
</li>
<li><p>用一个圆角而中空的图来盖住。</p>
</li>
<li><p>tableview需要刷新数据时，使用<br>[tableview beginUpdates]、[tableview insertRowsAtIndexPaths:indexArray withRowAnimation:UITableViewRowAnimationNone]、<br>[tableview endUpdates];而非<br>[tableview reloadData]从而刷新更少的行减少CPU压力</p>
</li>
</ul>
<ol start="8">
<li><p>对于固定行高，前一个设置属性比后一个实现代理方法效率高</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">cell.tableview.rowHeight = <span class="number">50.0</span>;</span><br><span class="line"></span><br><span class="line">- (<span class="built_in">CGFloat</span>)tableView:(<span class="built_in">UITableView</span> *)tableView heightForRowAtIndexPath:(<span class="built_in">NSIndexPath</span> *)indexPath</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">50.0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>NSDateFormatter这个对象的相关操作很费时，需要避免频繁的创建和计算</p>
</li>
</ol>

      
    </div>
    
      <div class="full-width auto-padding tags">
        
          <a href="/tags/iOS/" rel="nofollow"><i class="fas fa-hashtag fa-fw"></i>iOS</a>
        
          <a href="/tags/Objective-C/" rel="nofollow"><i class="fas fa-hashtag fa-fw"></i>Objective-C</a>
        
      </div>
    
  </section>
</article>

          </div>
        
      
    
  </section>
  
    
    <!-- 根据主题中的设置决定是否在archive中针对摘要部分的MathJax公式加载mathjax.js文件 -->
    
    

  


	
</div>
<aside class="l_side">
  
    
    
      
        
          
          
            <section class="widget author">
  <div class="content pure">
    
      <div class="avatar">
        <img class="avatar" src="https://raw.githubusercontent.com/Fongim/personal_blog_image/master/image/20190516125601.jpg">
      </div>
    
    
    
      <div class="social-wrapper">
        
          
            <a href="https://github.com/Fongim" class="social fab fa-github flat-btn" target="_blank" rel="external nofollow noopener noreferrer">
            </a>
          
        
          
            <a href="mailto:me@paaatrick.com" class="social fas fa-envelope flat-btn" target="_blank" rel="external nofollow noopener noreferrer">
            </a>
          
        
          
            <a href="https://me.csdn.net/fongim" class="social fab fa-contao flat-btn" target="_blank" rel="external nofollow noopener noreferrer">
            </a>
          
        
      </div>
    
  </div>
</section>

          
        
      
        
          
          
            

          
        
      
        
          
          
            
  <section class="widget category">
    
<header class="pure">
  <div><i class="fas fa-folder-open fa-fw" aria-hidden="true"></i>&nbsp;&nbsp;文章分类</div>
  
    <a class="rightBtn" rel="nofollow" href="/categories/" title="categories/">
    <i class="fas fa-expand-arrows-alt fa-fw"></i></a>
  
</header>

    <div class="content pure">
      <ul class="entry">
        
          <li><a class="flat-box" title="/categories/Algorithm/" href="/categories/Algorithm/"><div class="name">Algorithm</div><div class="badge">(10)</div></a></li>
        
          <li><a class="flat-box" title="/categories/Life/" href="/categories/Life/"><div class="name">Life</div><div class="badge">(4)</div></a></li>
        
          <li><a class="flat-box" title="/categories/Note/" href="/categories/Note/"><div class="name">Note</div><div class="badge">(12)</div></a></li>
        
          <li><a class="flat-box" title="/categories/Tech/" href="/categories/Tech/"><div class="name">Tech</div><div class="badge">(10)</div></a></li>
        
      </ul>
    </div>
  </section>


          
        
      
        
          
          
            
  <section class="widget tagcloud">
    
<header class="pure">
  <div><i class="fas fa-fire fa-fw" aria-hidden="true"></i>&nbsp;&nbsp;热门标签</div>
  
    <a class="rightBtn" rel="nofollow" href="/tags/" title="tags/">
    <i class="fas fa-expand-arrows-alt fa-fw"></i></a>
  
</header>

    <div class="content pure">
      <a href="/tags/Algorithm/" style="font-size: 19px; color: #777">Algorithm</a> <a href="/tags/Food/" style="font-size: 16.5px; color: #888">Food</a> <a href="/tags/Hotel/" style="font-size: 14px; color: #999">Hotel</a> <a href="/tags/LeetCode/" style="font-size: 19px; color: #777">LeetCode</a> <a href="/tags/NetworkProtocol/" style="font-size: 16.5px; color: #888">NetworkProtocol</a> <a href="/tags/Objective-C/" style="font-size: 21.5px; color: #666">Objective-C</a> <a href="/tags/Python/" style="font-size: 19px; color: #777">Python</a> <a href="/tags/WordPress/" style="font-size: 16.5px; color: #888">WordPress</a> <a href="/tags/iOS/" style="font-size: 24px; color: #555">iOS</a>
    </div>
  </section>


          
        
      
    

  
</aside>

<footer id="footer" class="clearfix">
  
  
    <div class="social-wrapper">
      
        
          <a href="https://github.com/Fongim" class="social fab fa-github flat-btn" target="_blank" rel="external nofollow noopener noreferrer">
          </a>
        
      
        
          <a href="mailto:me@paaatrick.com" class="social fas fa-envelope flat-btn" target="_blank" rel="external nofollow noopener noreferrer">
          </a>
        
      
        
          <a href="https://me.csdn.net/fongim" class="social fab fa-contao flat-btn" target="_blank" rel="external nofollow noopener noreferrer">
          </a>
        
      
    </div>
  
  <br>
  <div><p>©2019 派大星星星星</p>
</div>
  <div>
    本站使用
    <a href="https://xaoxuu.com/wiki/material-x/" target="_blank" class="codename">Material X</a>
    作为主题
    
      ，
      总访问量为
      <span id="busuanzi_value_site_pv"><i class="fas fa-spinner fa-spin fa-fw" aria-hidden="true"></i></span>
      次
    
    。
  </div>
</footer>
<script>setLoadingBarProgress(80);</script>




	<!-- 根据主题中的设置决定是否在archive中针对摘要部分的MathJax公式加载mathjax.js文件 -->
	

	


      <script>setLoadingBarProgress(60);</script>
    </div>
    <a class="s-top fas fa-arrow-up fa-fw" href='javascript:void(0)'></a>
  </div>
  <script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script>

  <script>
    var GOOGLE_CUSTOM_SEARCH_API_KEY = "";
    var GOOGLE_CUSTOM_SEARCH_ENGINE_ID = "";
    var ALGOLIA_API_KEY = "";
    var ALGOLIA_APP_ID = "";
    var ALGOLIA_INDEX_NAME = "";
    var AZURE_SERVICE_NAME = "";
    var AZURE_INDEX_NAME = "";
    var AZURE_QUERY_KEY = "";
    var BAIDU_API_ID = "";
    var SEARCH_SERVICE = "hexo" || "hexo";
    var ROOT = "/"||"/";
    if(!ROOT.endsWith('/'))ROOT += '/';
  </script>

<script src="//instant.page/1.2.2" type="module" integrity="sha384-2xV8M5griQmzyiY3CDqh1dn4z3llDVqZDqzjzcY+jCBCk/a5fXJmuZ/40JJAPeoU"></script>


  <script async src="https://cdn.jsdelivr.net/npm/scrollreveal@4.0.5/dist/scrollreveal.min.js"></script>
  <script type="text/javascript">
    $(function() {
      const $reveal = $('.reveal');
      if ($reveal.length === 0) return;
      const sr = ScrollReveal({ distance: 0 });
      sr.reveal('.reveal');
    });
  </script>


  <script src="https://cdn.jsdelivr.net/npm/node-waves@0.7.6/dist/waves.min.js"></script>
  <script type="text/javascript">
    $(function() {
      Waves.attach('.flat-btn', ['waves-button']);
      Waves.attach('.float-btn', ['waves-button', 'waves-float']);
      Waves.attach('.float-btn-light', ['waves-button', 'waves-float', 'waves-light']);
      Waves.attach('.flat-box', ['waves-block']);
      Waves.attach('.float-box', ['waves-block', 'waves-float']);
      Waves.attach('.waves-image');
      Waves.init();
    });
  </script>


  <script async src="https://cdn.jsdelivr.net/gh/xaoxuu/cdn-busuanzi@2.3/js/busuanzi.pure.mini.js"></script>




  
  
  
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-backstretch/2.0.4/jquery.backstretch.min.js"></script>
    <script type="text/javascript">
      $(function(){
        const images = ["https://raw.githubusercontent.com/Fongim/personal_blog_image/master/image/20190516120523.jpeg", "https://raw.githubusercontent.com/Fongim/personal_blog_image/master/image/20190516120522.jpeg", "https://raw.githubusercontent.com/Fongim/personal_blog_image/master/image/20190516120521.jpeg", "https://raw.githubusercontent.com/Fongim/personal_blog_image/master/image/20190516120520.jpeg", "https://raw.githubusercontent.com/Fongim/personal_blog_image/master/image/20190516120519.jpeg", "https://raw.githubusercontent.com/Fongim/personal_blog_image/master/image/20190516120518.jpeg", "https://raw.githubusercontent.com/Fongim/personal_blog_image/master/image/20190516120517.jpeg", "https://raw.githubusercontent.com/Fongim/personal_blog_image/master/image/20190516120516.jpeg", "https://raw.githubusercontent.com/Fongim/personal_blog_image/master/image/20190516120515.jpeg"];
        for (let i = 1; i < images.length; i++) {
          const random = Math.floor(Math.random() * (i + 1));
          [images[i], images[random]] = [images[random], images[i]];
        }
        if ('') {
          $('').backstretch(images, 
          {
            duration: "40000",
            fade: "2500"
          });
        } else {
          $.backstretch(images, 
          {
            duration: "40000",
            fade: "2500"
          });
        }
      });
    </script>
  











  <script src="/js/app.js"></script>


  <script src="/js/search.js"></script>




<!-- 复制 -->
<script src="https://cdn.jsdelivr.net/npm/clipboard@2/dist/clipboard.min.js"></script>
<script>
  let COPY_SUCCESS = "复制成功";
  let COPY_FAILURE = "复制失败";
  /*页面载入完成后，创建复制按钮*/
  !function (e, t, a) {
    /* code */
    var initCopyCode = function(){
      var copyHtml = '';
      copyHtml += '<button class="btn-copy" data-clipboard-snippet="">';
      copyHtml += '  <i class="fa fa-copy"></i><span>复制</span>';
      copyHtml += '</button>';
      $(".highlight .code pre").before(copyHtml);
      var clipboard = new ClipboardJS('.btn-copy', {
        target: function(trigger) {
          return trigger.nextElementSibling;
        }
      });

      clipboard.on('success', function(e) {
        //您可以加入成功提示
        console.info('Action:', e.action);
        console.info('Text:', e.text);
        console.info('Trigger:', e.trigger);
        success_prompt(COPY_SUCCESS);
        e.clearSelection();
      });
      clipboard.on('error', function(e) {
        //您可以加入失败提示
        console.error('Action:', e.action);
        console.error('Trigger:', e.trigger);
        fail_prompt(COPY_FAILURE);
      });
    }
    initCopyCode();

  }(window, document);

  /**
   * 弹出式提示框，默认1.5秒自动消失
   * @param message 提示信息
   * @param style 提示样式，有alert-success、alert-danger、alert-warning、alert-info
   * @param time 消失时间
   */
  var prompt = function (message, style, time)
  {
      style = (style === undefined) ? 'alert-success' : style;
      time = (time === undefined) ? 1500 : time*1000;
      $('<div>')
          .appendTo('body')
          .addClass('alert ' + style)
          .html(message)
          .show()
          .delay(time)
          .fadeOut();
  };

  // 成功提示
  var success_prompt = function(message, time)
  {
      prompt(message, 'alert-success', time);
  };

  // 失败提示
  var fail_prompt = function(message, time)
  {
      prompt(message, 'alert-danger', time);
  };

  // 提醒
  var warning_prompt = function(message, time)
  {
      prompt(message, 'alert-warning', time);
  };

  // 信息提示
  var info_prompt = function(message, time)
  {
      prompt(message, 'alert-info', time);
  };

</script>


<!-- fancybox -->
<script src="https://cdn.jsdelivr.net/gh/fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.js"></script>
<script>
  let LAZY_LOAD_IMAGE = "";
  $(".article-entry").find("fancybox").find("img").each(function () {
      var element = document.createElement("a");
      $(element).attr("data-fancybox", "gallery");
      $(element).attr("href", $(this).attr("src"));
      /* 图片采用懒加载处理时,
       * 一般图片标签内会有个属性名来存放图片的真实地址，比如 data-original,
       * 那么此处将原本的属性名src替换为对应属性名data-original,
       * 修改如下
       */
       if (LAZY_LOAD_IMAGE) {
         $(element).attr("href", $(this).attr("data-original"));
       }
      $(this).wrap(element);
  });
</script>





  <script>setLoadingBarProgress(100);</script>
</body>
</html>
